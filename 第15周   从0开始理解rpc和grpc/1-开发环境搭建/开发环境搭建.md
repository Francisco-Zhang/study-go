## 1、课程目标

1. go语言开发流行的电商系统

   为什么电商：电商系统具备完整的微服务开发细节

2. 理解微服务的所有细节——从0到1实现

   为什么从0到1：自研能帮我们理解透彻很多细节，go语言没有大一统的微服务框架，不像java有springcloud。

   go语言在微服务领域发展很快，框架很多，没有哪个框架有发展成统领的趋势。

3. 分布式系统核心问题——分布式锁、分布式事务。

   

## 2、开发环境介绍

![1](img/1.png)

## 3、Windows安装centos7虚拟机

1. 安装virtualbox

   下载地址：https://www.virtualbox.org/wiki/Download_Old_Builds_6_0 （下载最新版本，不然可能无法兼容最新版本的centos7）

   选择：		windows hosts

2. 安装centos

   阿里云开源镜像站：http://mirrors.aliyun.com/

   选择路径：				https://mirrors.aliyun.com/centos/7/isos/x86_64/

   下载镜像：				CentOS-7-x86_64-DVD-2009.iso

3. 安装centos，网络选择桥接。主机与虚拟机之间要互相ping通。

4. 桥接网卡--Wireless LAN

## 4、linux Git 安装

1. yum install git

2. git config --global user.name "zxz"

3. git config --global user.email "zxz@gmail.com"

4. git config --global --list

   

## 5、安装docker 和 docker-compose

### 1、安装docker

1. 安装

   ```shell
   curl -fsSL  https://get.docker.com	| bash -s docker --mirror	Aliyun
   ```

2. 设置开机启动docker

   ```shell
   systemctl enable docker
   ```

3. 测试

   ```shell
   docker ps -a
   输出：Cannot connect to the Docker daemon at unix:///var/run/docker.sock. Is the docker daemon running?
   #说明docker服务没有启动，再次使用命令检测。
   ps -ef | grep docker
   ```

4. 启动docker

   ```shell
   systemctl start docker
   ```

### 2、配置阿里云镜像

登录阿里云——控制台——产品与服务——容器镜像服务——镜像加速器

```shell
sudo mkdir -p /etc/docker
sudo tee /etc/docker/daemon.json <<-'EOF'
{
  "registry-mirrors": ["https://fqi6q4c6.mirror.aliyuncs.com"]
}
EOF
sudo systemctl daemon-reload
sudo systemctl restart docker
```

### 3、启动

```shell
sudo systemctl start docker
```

### 4、测试一下

```shell
sudo docker run hello-world

#输出下面信息说明启动容器启动成功
Unable to find image 'hello-world:latest' locally
latest: Pulling from library/hello-world
2db29710123e: Pull complete 
Digest: sha256:2498fce14358aa50ead0cc6c19990fc6ff866ce72aeb5546e1d59caac3d0d60f
Status: Downloaded newer image for hello-world:latest

Hello from Docker!
```

### 5、删除容器

```sh
docker rm 容器ID
```



### 6、安装docker-compose

1. 下载

   ```shell
   # 国内镜像地址
   curl -L https://get.daocloud.io/docker/compose/releases/download/1.25.0/docker-compose-`uname -s`-`uname -m` > /usr/local/bin/docker-compose
   
   # 下载完之后可以看下 /usr/local/bin 这个目录有没有 docker-compose 这个文件
   ```

2. 授权

   ```shell
   # 给docker compose 目录授权
   sudo chmod +x /usr/local/bin/docker-compose
   
   # 查看一下version，显示有版本号那就说明安装成功了
   docker-compose version  或者	docker-compose -v
   ```

   

## 6、安装mysql

1. 下载镜像

   ```shell
   docker pull mysql:5.7
   ```

2. 通过镜像启动docker

   ```shell
   docker run -p 3306:3306 --name mymysql -v  $PWD/conf:/etc/mysql/conf.d -v $PWD/logs:/logs -v $PWD/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 -d mysql:5.7
   
    # -v $PWD/data:/var/lib/mysql 将主机当前目录下的data目录挂载到容器内部的/var/lib/mysql，这样主机的data目录就指向了容器内部的/var/lib/mysql目录。这样就能通过主机查看容器内的目录文件了。
   ```

3. 查看容器

   ![2](img/2.png)

   STATUS:UP  表示容器内服务正在运行。

4. 如果是Exited退出状态，证明容器启动出错了，通过 docker logs 容器ID 查看日志。

5. 进入容器内配置

   由于mysql的安全策略，现在还不能用root/123456来访问数据库

   ```shell
   #进入容器
   docker exec  -it 651cdde082a5 /bin/bash
   #进入mysql
   mysql -uroot -p123456
   # 表示有所有的权限，除了grant这个命令，这个命令是root才有的。此处密码被修改成了root
   grant all privileges  on *.* to 'root'@'%' identified by 'root' with grant option;
   grant all privileges  on *.* to 'root'@'127.0.0.1' identified by 'root' with grant option;
   grant all privileges  on *.* to 'root'@'localhost' identified by 'root' with grant option;
   flush privileges
   ```

6. 输入两次 exit 先退出mysql,再退出容器。

## 7、windows下安装go 和 goland

### go环境安装

建议去go语言中文网下载，网址：https://studygolang.com/dl

直接下载安装包安装，windows下安装后会自动添加环境变量。

### go依赖包仓库地址修改

国外的地址，go get 在进行安装的时候会比较慢，使用命令修改

go env -w  GOPROXY=https://goproxy.cn,direct  或者 https://goproxy.io,direct

go env -w GO111MODULE=on	(打开module模式)

### goland 安装

为了重启goland方便，安装过程中勾选 Update Path  Variable (restart needed)

### goland 破解

一、插件方式（稳定）
链接：https://pan.baidu.com/s/16NxZAJJzCmOHfwu1uOfGBg
提取码：TTTT
二、激活码方式（每天早上更新一次，不稳定，基本半天下午就会失效）
1、用浏览器打开网址: vrg123.com
2、在网址上输入密钥：4565

### goland 代码自动格式化

1、setting——tools——File Watchers——新增 go fmt

2、安装goimports 	go get golang.org/x/tools/cmd/goimports	 **(如果本地已经存在，不需要再次安装)**

3、新增 goimports

### goland 新建项目

环境变量需要填修改后的仓库地址

![3](img/3.png)

测试

新建文件，粘贴 gin代码，选择Sync dependencies of awesomeProject，goland会自动下载 gin 包。

```go
package main

import "github.com/gin-gonic/gin"

func main() {
	r := gin.Default()
	r.GET("/ping", func(c *gin.Context) {
		c.JSON(200, gin.H{
			"message": "pong",
		})
	})
	r.Run() // listen and serve on 0.0.0.0:8080 (for windows "localhost:8080")
}
```

